function sortHistory(b){b.sort(function(b,h){return b.date>h.date?-1:b.date<h.date?1:0})}
function Magitfun(){var b,k,h,l,m,j,i;2==arguments.length?(k=arguments[0],h=arguments[1]):b=arguments[0];this.getCookie=function(){return b};this.getCaptchaUrl=function(){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=2&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(a){i="http://www.magtifun.ge/";i=i+$(a).find("#verif_img").attr("src")}});return i};this.login=function(a){var c=$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=11&lang=ge",
data:{act:1,user:k,password:h},cache:false,crossDomain:true,beforeSend:function(a){a.setRequestHeader("Cookie","")},success:function(d){b=c.getResponseHeader("Set-Cookie").split(";")[0];q(a);n(d)}})};this.sendSms=function(a,c,d,f){for(var a=a.split(","),e=0,g=a.length;e<g;e++)$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/sms_send.php",data:{recipients:a[e],message_body:c,verif_box:d},beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(a){alert(a);f(a)}})};this.getContacts=
function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=5&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(c){if(c=c.match(/Array\(.+?\)/g))for(var d=0,f=c.length;d<f;d++){var b=c[d].match(/\("(.*?)"\)/);c[d]=b[1].split(/"\s*,\s*"/)}a(c)}})};this.getBalance=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=1&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(c){n(c);a(l,m)}})};this.getHistory=
function(a,c){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(d){var b=$(d).find(".page_number,active,red,round_border,english").length-1;c>-1&&(b=c);j=[];o(d);p(a,2,b+1)}})};var p=function(a,c,d){if(c>=d){sortHistory(j);a(j)}else $.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",data:{cur_page:c,fav_page:0},beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(b){o(b);
p(a,++c,d)}})},o=function(a){for(var c=$(a).find("#message_list").children(),b=0,f=c.length;b<f;b++){var e=$(c[b]),g={};g.msgID=$($(a).find("#message_list").children())[b].id;g.msgText=e.find(".msg_text").text();e.find(".message_list_recipient > .red").each(function(a,b){if($(b).text().replace(/[^\+\d]/g,""))g.number=$(b).text().replace(/[^\+\d]/g,"")});e.find(".message_list_recipient > .gray").each(function(a,b){$(b).text().replace(/[^\+\d]/g,"")?g.number=$(b).text().replace(/[^\+\d]/g,""):g.status=
$(b).text()});var h=e.find(".msg_date").find(".date_month").html().split("<br>"),i=e.find(".date_time").text().split(":");g.date=new Date(h[1],r(h[0]),e.find(".msg_date").find(".xlarge").text(),i[0],i[1],i[2]);j.push(g)}},r=function(a){if(a=="\u10d8\u10dc\u10d5")return 0;if(a=="\u10d7\u10d4\u10d1")return 1;if(a=="\u10db\u10d0\u10e0")return 2;if(a=="\u10d0\u10de\u10e0")return 3;if(a=="\u10db\u10d0\u10d8")return 4;if(a=="\u10d8\u10d5\u10dc")return 5;if(a=="\u10d8\u10d5\u10da")return 6;if(a=="\u10d0\u10d2\u10d5")return 7;
if(a=="\u10e1\u10d4\u10e5")return 8;if(a=="\u10dd\u10e5\u10e2")return 9;if(a=="\u10dc\u10dd\u10d4")return 10;if(a=="\u10d3\u10d4\u10d9")return 11},n=function(a){$(a).find(".dark").filter(".english").filter("span").each(function(a,b){var f=$(b);f.hasClass("xxlarge")?l=f.text():m=f.text()})},q=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/profile_check.php",beforeSend:function(a){a.setRequestHeader("Cookie",b)},success:function(b){a(b)}})}};