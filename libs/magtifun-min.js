function sortHistory(c){c.sort(function(c,e){return c.date>e.date?-1:c.date<e.date?1:0})}
function Magitfun(){var c,k,e,l,m,i;2==arguments.length?(k=arguments[0],e=arguments[1]):c=arguments[0];this.getCookie=function(){return c};this.login=function(a){var b=$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=11&lang=ge",data:{act:1,user:k,password:e},cache:false,crossDomain:true,beforeSend:function(a){a.setRequestHeader("Cookie","")},success:function(d){c=b.getResponseHeader("Set-Cookie").split(";")[0];q(a);n(d)}})};this.sendSms=function(a,b,d){for(var a=a.split(","),f=0,g=
    a.length;f<g;f++)$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/sms_send.php",data:{recipients:a[f],message_body:b},beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(a){d(a)}})};this.getContacts=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=5&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){if(b=b.match(/Array\(.+?\)/g))for(var d=0,f=b.length;d<f;d++){var c=b[d].match(/\("(.*?)"\)/);b[d]=c[1].split(/"\s*,\s*"/)}a(b)}})};
    this.getBalance=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=1&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){n(b);a(l,m)}})};this.getHistory=function(a,b){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(d){var f=$(d).find(".page_number,active,red,round_border,english").length-1;b>-1&&(f=b);i=[];o(d);p(a,2,f+1)}})};var p=function(a,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      d){if(b>=d){sortHistory(i);a(i)}else $.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",data:{cur_page:b,fav_page:0},beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(c){o(c);p(a,++b,d)}})},o=function(a){for(var b=$(a).find("#message_list").children(),d=0,c=b.length;d<c;d++){var g=$(b[d]),h={};h.msgID=$($(a).find("#message_list").children())[d].id;h.msgText=g.find(".msg_text").text();g.find(".message_list_recipient > .red").each(function(a,b){if($(b).text().replace(/[^\+\d]/g,
            ""))h.number=$(b).text().replace(/[^\+\d]/g,"")});g.find(".message_list_recipient > .gray").each(function(a,b){$(b).text().replace(/[^\+\d]/g,"")?h.number=$(b).text().replace(/[^\+\d]/g,""):h.status=$(b).text()});var e=g.find(".msg_date").find(".date_month").text().split(/\s+/),j=g.find(".date_time").text().split(":");h.date=new Date(e[1],r(e[0]),g.find(".msg_date").find(".xlarge").text(),j[0],j[1],j[2]);i.push(h)}},r=function(a){if(a=="\u10d8\u10dc\u10d5")return 0;if(a=="\u10d7\u10d4\u10d1")return 1;
            if(a=="\u10db\u10d0\u10e0")return 2;if(a=="\u10d0\u10de\u10e0")return 3;if(a=="\u10db\u10d0\u10d8")return 4;if(a=="\u10d8\u10d5\u10dc")return 5;if(a=="\u10d8\u10d5\u10da")return 6;if(a=="\u10d0\u10d2\u10d5")return 7;if(a=="\u10e1\u10d4\u10e5")return 8;if(a=="\u10dd\u10e5\u10e2")return 9;if(a=="\u10dc\u10dd\u10d4")return 10;if(a=="\u10d3\u10d4\u10d9")return 11},n=function(a){$(a).find(".dark").filter(".english").filter("span").each(function(a,d){var c=$(d);c.hasClass("xxlarge")?l=c.text():m=c.text()})},
        q=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/profile_check.php",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){b!="not_logged_in"?a("succses"):a(b)}})}};