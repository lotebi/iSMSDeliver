/**
 * Created by JetBrains WebStorm.
 * User: Luka
 * Date: 3/29/12
 * Time: 10:18 PM
 * To change this template use File | Settings | File Templates.
 */
function Magitfun(){var a;var b;var c;var d;var e;var f;if(arguments.length==2){b=arguments[0];c=arguments[1]}else{a=arguments[0]}this.getCookie=function(){return a};this.login=function(d){var e=$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=11&lang=ge",data:{act:1,user:b,password:c},cache:false,crossDomain:true,beforeSend:function(a){a.setRequestHeader("Cookie","")},success:function(b){a=e.getResponseHeader("Set-Cookie").split(";")[0];k(d);j(b)}})};this.sendSms=function(b,c,d){var e=b.split(",");for(var f=0;f<e.length;f++){$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/sms_send.php",data:{recipients:e[f],message_body:c},beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){d(a)}})}};this.getContacts=function(b){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=5&lang=ge",beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){var c=/Array\(.+?\)/g;var d=a.match(c);if(d){for(var e=0;e<d.length;e++){var f=d[e].match(/\("(.*?)"\)/);d[e]=f[1].split(/"\s*,\s*"/)}}b(d)}})};this.getBalance=function(b){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=1&lang=ge",beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){j(a);b(d,e)}})};this.getHistory=function(b,c){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){var d=$(a).find(".page_number,active,red,round_border,english").length-1;if(c>-1){d=c}f=new Array;h(a);g(b,2,d+1)}})};var g=function(b,c,d){if(c>=d){sortHistory(f);b(f)}else{$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",data:{cur_page:c,fav_page:0},beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){h(a);g(b,++c,d)}})}};var h=function(a){var b=$(a).find("#message_list").children();for(var c=0;c<b.length;c++){var d=$(b[c]);var e={};e.msgID=$($(a).find("#message_list").children())[c].id;e.msgText=d.find(".msg_text").text();d.find(".message_list_recipient > .red").each(function(a,b){if($(b).text().replace(/[^\+\d]/g,"")){e.number=$(b).text().replace(/[^\+\d]/g,"")}});d.find(".message_list_recipient > .gray").each(function(a,b){if($(b).text().replace(/[^\+\d]/g,"")){e.number=$(b).text().replace(/[^\+\d]/g,"")}else{e.status=$(b).text()}});var g=d.find(".msg_date").find(".date_month").html().split("<br>");var h=d.find(".date_time").text().split(":");e.date=new Date(g[1],i(g[0]),d.find(".msg_date").find(".xlarge").text(),h[0],h[1],h[2]);f.push(e)}};var i=function(a){if(a=="ინვ"){return 0}else if(a="თებ"){return 1}else if(a=="მარ"){return 2}else if(a=="აპრ"){return 3}else if(a=="მაი"){return 4}else if(a=="ივნ"){return 5}else if(a=="ივლ"){return 6}else if(a=="აგვ"){return 7}else if(a=="სექ"){return 8}else if(a=="ოქტ"){return 9}else if(a=="ნოე"){return 10}else if(a=="დეკ"){return 11}};var j=function(a){$(a).find(".dark").filter(".english").filter("span").each(function(a,b){var c=$(b);if(c.hasClass("xxlarge")){d=c.text()}else{e=c.text()}})};var k=function(b){$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/profile_check.php",beforeSend:function(b){b.setRequestHeader("Cookie",a)},success:function(a){if(a!="not_logged_in"){b("succses")}else{b(a)}}})}}function sortHistory(a){a.sort(function(a,b){if(a.date>b.date)return-1;if(a.date<b.date)return 1;return 0})}