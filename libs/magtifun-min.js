function sortHistory(c){c.sort(function(c,e){return c.date>e.date?-1:c.date<e.date?1:0})}
function Magitfun(){var c,k,e,l,m,h;2==arguments.length?(k=arguments[0],e=arguments[1]):c=arguments[0];this.getCookie=function(){return c};this.login=function(a){var b=$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=11&lang=ge",data:{act:1,user:k,password:e},cache:false,crossDomain:true,beforeSend:function(a){a.setRequestHeader("Cookie","")},success:function(d){c=b.getResponseHeader("Set-Cookie").split(";")[0];q(a);$(d).find("#verif_img").attr("src");n(d)}})};this.sendSms=function(a,
b,d,i){for(var a=a.split(","),f=0,g=a.length;f<g;f++)$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/sms_send.php",data:{recipients:a[f],message_body:b,verif_box:d},beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(a){alert(a);i(a)}})};this.getContacts=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=5&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){if(b=b.match(/Array\(.+?\)/g))for(var d=0,i=b.length;d<i;d++){var c=
b[d].match(/\("(.*?)"\)/);b[d]=c[1].split(/"\s*,\s*"/)}a(b)}})};this.getBalance=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=1&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){n(b);a(l,m)}})};this.getHistory=function(a,b){$.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(d){var c=$(d).find(".page_number,active,red,round_border,english").length-
1;b>-1&&(c=b);h=[];o(d);p(a,2,c+1)}})};var p=function(a,b,d){if(b>=d){sortHistory(h);a(h)}else $.ajax({type:"POST",url:"http://www.magtifun.ge/index.php?page=10&lang=ge",data:{cur_page:b,fav_page:0},beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(c){o(c);p(a,++b,d)}})},o=function(a){for(var b=$(a).find("#message_list").children(),d=0,c=b.length;d<c;d++){var f=$(b[d]),g={};g.msgID=$($(a).find("#message_list").children())[d].id;g.msgText=f.find(".msg_text").text();f.find(".message_list_recipient > .red").each(function(a,
b){if($(b).text().replace(/[^\+\d]/g,""))g.number=$(b).text().replace(/[^\+\d]/g,"")});f.find(".message_list_recipient > .gray").each(function(a,b){$(b).text().replace(/[^\+\d]/g,"")?g.number=$(b).text().replace(/[^\+\d]/g,""):g.status=$(b).text()});var e=f.find(".msg_date").find(".date_month").html().split("<br>"),j=f.find(".date_time").text().split(":");g.date=new Date(e[1],r(e[0]),f.find(".msg_date").find(".xlarge").text(),j[0],j[1],j[2]);h.push(g)}},r=function(a){if(a=="\u10d8\u10dc\u10d5")return 0;
if(a=="\u10d7\u10d4\u10d1")return 1;if(a=="\u10db\u10d0\u10e0")return 2;if(a=="\u10d0\u10de\u10e0")return 3;if(a=="\u10db\u10d0\u10d8")return 4;if(a=="\u10d8\u10d5\u10dc")return 5;if(a=="\u10d8\u10d5\u10da")return 6;if(a=="\u10d0\u10d2\u10d5")return 7;if(a=="\u10e1\u10d4\u10e5")return 8;if(a=="\u10dd\u10e5\u10e2")return 9;if(a=="\u10dc\u10dd\u10d4")return 10;if(a=="\u10d3\u10d4\u10d9")return 11},n=function(a){$(a).find(".dark").filter(".english").filter("span").each(function(a,c){var e=$(c);e.hasClass("xxlarge")?
l=e.text():m=e.text()})},q=function(a){$.ajax({type:"POST",url:"http://www.magtifun.ge/scripts/profile_check.php",beforeSend:function(a){a.setRequestHeader("Cookie",c)},success:function(b){b!="not_logged_in"?a("succses"):a(b)}})}};