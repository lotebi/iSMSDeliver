var connectorObject,history,contactsRemote,contactsLocal=[],contactsMerged,transitions=[];transitions.push("pop");transitions.push("flip");transitions.push("slide");transitions.push("slideup");transitions.push("slidedown");
$(function(){$("#login").click(function(a){a.preventDefault();$.mobile.showPageLoadingMsg();var a=$("#username").val(),b=$("#password").val();connectorObject=new Magitfun(a,b);connectorObject.login(function(a){"succses"==a?($.mobile.changePage($("#pageHome")),refreshBalance()):(navigator.notification.vibrate(250),navigator.notification.alert("Wrong Username or Password",null,"MissBehaive","I'm Sorry!"));$.mobile.hidePageLoadingMsg()})});$("#pageHome").live("pageshow",function(){$.mobile.showPageLoadingMsg();
    grabContacts();grabHistory(2)});$("#refresh").click(function(a){a.preventDefault();$.mobile.showPageLoadingMsg();refreshBalance();grabHistory(2)});$("#send").click(function(a){a.preventDefault();$.mobile.showPageLoadingMsg();if("hidden"==$("#maxMessages").css("visibility")){var a=$("#recipients").val(),b=$("#msgBody").val();connectorObject.sendSms(a,b,function(){$("#recipients").val("");$("#msgBody").val("");refreshBalance();grabHistory(2);onMsgChange()})}else navigator.notification.alert("You exsided message character limit",
    null,"MissBehaive","I'm Sorry!")});$("#msgBody").keyup(onMsgChange);$("#msgBody").keydown(onMsgChange);$("#msgBody").bind("change",onMsgChange);$("#logout").click(function(a){a.preventDefault();getRandTransition();$.mobile.changePage($("#pageLogin"))});$("#about").click(function(a){a.preventDefault();navigator.notification.alert("Ra About ?? Button Dainaxe da daachire?",null,"Kai roja Xar?","sxvagan movxvdi")});$("#navbarSms").click(function(a){a.preventDefault();$(".contacts-view").html(" ");$(".content-sms").css("display",
    "block");$(".content-history").css("display","none");$(".content-contacts").css("display","none")});$("#navbarHistory").click(function(a){a.preventDefault();$(".contacts-view").html(" ");$(".content-history").css("display","block");$(".content-sms").css("display","none");$(".content-contacts").css("display","none")});$("#navbarContacts").click(function(a){a.preventDefault();$(".contacts-view").html(" ");$(".content-contacts").css("display","block");$(".content-sms").css("display","none");$(".content-history").css("display",
    "none");$(".contacts-choose").css("display","block");$(".contacts-view").css("display","none")});$("#allContacts").click(function(a){a.preventDefault();generateContacts("",!0);$(".contacts-choose").css("display","none");$(".contacts-view").css("display","block")});$("#localContacts").click(function(a){a.preventDefault();generateContacts(contactsLocal,!1);$(".contacts-choose").css("display","none");$(".contacts-view").css("display","block")});$("#providerContacts").click(function(a){a.preventDefault();
    generateContacts(contactsRemote,!1);$(".contacts-choose").css("display","none");$(".contacts-view").css("display","block")});document.addEventListener("deviceready",function(){$.mobile.touchOverflowEnabled=!0;var a=new ContactFindOptions;a.filter="";a.multiple=!0;filter=["displayName","name","phoneNumbers"];navigator.contacts.find(filter,function(a){for(var c=0,g=a.length;c<g;c++){var e=a[c],d={};d.name=e.name.formatted;d.number=[];for(var f=0;f<e.phoneNumbers.length;f++)d.number.push(e.phoneNumbers[f].value);
    contactsLocal.push(d)}sortContacts(contactsLocal)},function(){navigator.notification.alert("Something Bad Happened About Contacts\nMaybe You Should Start Again",null,"Tragedy","understood")},a)},!1)});function refreshBalance(){connectorObject.getBalance(updateCreditsGel)}
function grabContacts(){connectorObject.getContacts(function(a){contactsRemote=[];for(var b=0,c=a.length;b<c;b++){for(var g=a[b],e={name:"",number:[]},d=1,f=g.length;d<f;d++){var h=g[d];if(4==d){e.number.push(h);break}else e.name=e.name+h+" "}e.name=e.name.trim();contactsRemote.push(e)}sortContacts(contactsRemote)})}function grabHistory(a){connectorObject.getHistory(function(a){history=a;generateHistory();normalizeHistory();resendListener();$.mobile.hidePageLoadingMsg()},a)}
function mergeContacts(){if(!contactsMerged){contactsMerged=[];for(var a=0,b=contactsRemote.length;a<b;a++)contactsMerged.push(contactsRemote[a]);a=0;for(b=contactsLocal.length;a<b;a++)contactsMerged.push(contactsLocal[a]);a={name:"Luka Dodelia",number:[]};a.number.push("599564266");contactsMerged.push(a)}return contactsMerged}
function generateContacts(a,b){$.mobile.showPageLoadingMsg();b&&(a=mergeContacts());sortContacts(a);for(var c='<ul data-role="listview" data-filter="true" data-filter-placeholder="Search contacts..." data-filter-theme="d" data-theme="d" data-divider-theme="d" >',g="",e=0,d=a.length;e<d;e++){var f=a[e];f.name[0].toUpperCase()!=g&&(g=f.name[0].toUpperCase(),c+='<li data-role="list-divider">'+g+"</li>");if(1<f.number.length){for(var h='<li><select name="select-choice-min" class="numberSelector"  data-native-menu="true" data-mini="true">',
                                                                                                                                                                                                                                                                                                                                                                                                                                                  h=h+("<option>"+f.name+"</option>"),i=0;i<f.number.length;i++)h+='<option value="'+f.number[i].replace(/[^\+\d]/g,"")+'">'+f.number[i]+"</option>";h+="</select></li>";c+=h}else c+='<li><a href="#" id="'+f.number[0].replace(/[^\+\d]/g,"")+'" class="contactName">'+f.name+"</a></li>"}c+="</ul>";$.mobile.hidePageLoadingMsg();$(".contacts-view").html(c);$(".contacts-view").trigger("create");contactsListener()}
function generateHistory(){var a,b=0,c=$(".content-history > .ui-listview");c.html("");for(var g=0,e=history.length;g<e;g++){var d=history[g];if(void 0==a||d.date.getDate()!=a.getDate()){a=d.date;var f=a.toDateString().split(" ");c.append('<li data-role="list-divider">'+(f[0]+","+f[1]+" "+f[2]+", "+f[3])+'<span class="ui-li-count">'+b+"</span></li>");b=0}b++;d="\u10db\u10d8\u10ec\u10dd\u10d3\u10d4\u10d1\u10e3\u10da\u10d8\u10d0"==d.status?'<li><h3 style="color: blue;">'+searchNumber(d.number)+"</h3><span>"+
    $("<div/>").text(d.msgText).html()+'</span><p class="ui-li-aside"><strong>'+d.date.getHours().toString()+":"+d.date.getMinutes().toString()+":"+d.date.getSeconds().toString()+"</strong></p></li>":'<li><a href="#" class="resendableMessage" id="'+d.msgID+'"><h3 style="color: blue;">'+searchNumber(d.number)+"</h3><span>"+d.msgText+'</span><p class="ui-li-aside"><strong>'+d.date.getHours().toString()+":"+d.date.getMinutes().toString()+":"+d.date.getSeconds().toString()+"</strong></p></a></li>";c.append(d)}c.listview("refresh")}
function searchNumber(a){for(var b=mergeContacts(),c=0,g=b.length;c<g;c++)for(var e=b[c],d=0;d<e.number.length;d++)if(-1<e.number[d].replace(/[^\+\d]/g,"").indexOf(a.replace(/[^\+\d]/g,"")))return e.name;return a}
function normalizeHistory(){for(var a=$(".content-history > .ui-listview > li[data-role='list-divider']"),b=0,c=a.length;b<c;b++){var g=$(".content-history > .ui-listview > li").index(a[b]),g=b+1!=c?$(".content-history > .ui-listview > li").index(a[b+1])-1-g:$(".content-history > .ui-listview > li").length-1-g;$(a[b]).children(".ui-li-count").text(g)}}
function onMsgChange(){var a=$("#msgBody").val().length;146>a?($("#charCount").text(146-a),$("#message").text(1),$("#maxMessages").css("visibility","hidden")):438<a?($("#charCount").text(438-a),$("#message").text(3),$("#maxMessages").css("visibility","visible")):292<a?($("#charCount").text(438-a),$("#message").text(3),$("#maxMessages").css("visibility","hidden")):146<a&&($("#charCount").text(292-a),$("#message").text(2),$("#maxMessages").css("visibility","hidden"))}
function contactsListener(){$("a.contactName").click(function(a){a.preventDefault();a=$(this).attr("id");$("#recipients").val()?$("#recipients").val($("#recipients").val()+","+a):$("#recipients").val(a);$(this).parents("li").remove()});$(".numberSelector").bind("change",function(){var a=$(this).find(":selected").val();$("#recipients").val()?$("#recipients").val($("#recipients").val()+","+a):$("#recipients").val(a);$(this).parents("li").remove()})}
function resendListener(){$("a.resendableMessage").click(function(a){a.preventDefault();resend($(this).attr("id"))})}
function resend(a){var b=historyByID(a);navigator.notification.confirm(b.msgText,function(a){2==a&&($("#recipients").val(b.number),$("#msgBody").val(b.msgText),$(".contacts-view").html(" "),$("#navbarHistory").removeClass("ui-btn-active"),$("#navbarSms").addClass("ui-btn-active"),$(".content-sms").css("display","block"),$(".content-history").css("display","none"),$(".content-contacts").css("display","none"))},"Recipient: "+b.number,"Cancel,Resend")}
function updateCreditsGel(a,b){$("#gel").text(b);$("#credit").text(a)}function getRandTransition(){return transitions[getRandomArbitrary(0,transitions.length)]}function getRandomArbitrary(a,b){return Math.round(Math.random()*(b-a)+a)}function historyByID(a){for(var b=0,c=history.length;b<c;b++)if(history[b].msgID==a)return history[b]}function sortContacts(a){a.sort(function(a,c){return a.name.toLowerCase()>c.name.toLowerCase()?1:a.name.toLowerCase()<c.name.toLowerCase()?-1:0})};